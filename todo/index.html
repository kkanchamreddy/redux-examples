<!DOCTYPE html>
<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.1.7/redux.js"></script>
	  <script src="http://fb.me/react-with-addons-0.14.3.js"></script>
	  <script src="http://fb.me/react-dom-0.14.3.js"></script>

	  <script src="https://wzrd.in/standalone/expect@latest"></script>
	  <script src="https://wzrd.in/standalone/deep-freeze@latest"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/react-redux/4.0.0/react-redux.js"></script>
	  <meta charset="utf-8">
	  <meta name="viewport" content="width=device-width">
  <title>JS Bin-Redux</title>
</head>
<body>
  <div id="root"> </di>
</body>

<script>
const {combineReducers, createStore} = Redux;
//const {createStore} = Redux;

const todo =(state = {}, action) => {
switch(action.type) {
    case 'ADD_TODO':
      return {
        text: action.text,
        id: action.id,
        done: false
      };

    case 'TOGGLE_TODO':
      if(state.id != action.id) {
        return state;
      }
      return {
        ...state,
        done: !state.done
      };

    default:
      return state;
}
}

const todos = (state = [], action) => {
switch(action.type) {
  case 'ADD_TODO':
    return [
      ...state,
      todo(undefined, action)
    ];
  case 'TOGGLE_TODO':
    return state.map(t => todo(t, action));
  default:
    return state;
}
};

const visibilitFilter = (state ='SHOW_ALL' , action) => {
switch (action.type) {
  case 'SET_VISIBILITY_FILTER':
    return action.filter;
  default:
    return state;
}
};

const todoApp = combineReducers({
todos,
visibilitFilter
});

const store = createStore(todoApp);

const {Component} =  React;

let nextTodoId = 0;
class TodoApp extends Component {
render() {
  return (
    <div>
      <input ref ={(node)=>{
          this.input = node;
      }}/>
      <button onClick = {()=> {
          store.dispatch({
            type: 'ADD_TODO',
            text: this.input.value,
            id: nextTodoId++
          });
          this.input.value = '';
       }}>
       Add Todo
      </button>
      <ul>
         {this.props.todos.map(todo =>
            <li key = {todo.id}
                onClick = {()=>{
                  store.dispatch({
                           type:'TOGGLE_TODO',
                           id: todo.id
                          });
                }}

                style = {{
                         textDecoration:
                           todo.done?
                           'line-through' :
                           'none'
                        }}>
               {todo.text} </li>
         )}
      </ul>
    </div>
  )
}
}

const render = () => {
ReactDOM.render(
  <TodoApp
    todos = {store.getState().todos}
  />,
  document.getElementById('root')
);
};


store.subscribe(render);
render();

</script>
</html>
